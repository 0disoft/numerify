---
// src/pages/bmi.astro
import Layout from "../layouts/Layout.astro";
---

<Layout title="BMI 계산기 - Numerify">
  <div class="mx-auto max-w-lg rounded-xl bg-white p-8 shadow-lg">
    <h1 class="mb-4 text-center text-3xl font-bold">BMI (체질량지수) 계산기</h1>

    <div class="mb-4">
      <label for="height" class="mb-2 block font-medium text-gray-700"
        >키 (cm)</label
      >
      <input
        type="number"
        id="height"
        class="w-full rounded-md border border-gray-300 p-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
        placeholder="예: 175"
      />
    </div>

    <div class="mb-6">
      <label for="weight" class="mb-2 block font-medium text-gray-700"
        >몸무게 (kg)</label
      >
      <input
        type="number"
        id="weight"
        class="w-full rounded-md border border-gray-300 p-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
        placeholder="예: 70"
      />
    </div>

    <button
      id="calculate-btn"
      class="w-full rounded-lg bg-indigo-600 py-3 text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
    >
      계산하기
    </button>

    <div id="result" class="mt-8 hidden rounded-lg bg-gray-100 p-6 text-center">
      <h2 class="text-xl font-semibold">
        당신의 BMI 지수는 <span id="bmi-value" class="text-indigo-600"
        ></span>입니다.
      </h2>
      <p id="bmi-status" class="mt-2 text-lg"></p>
    </div>
  </div>
</Layout>

<script>
  // DOM 요소들을 가져옵니다.
  const heightInput = document.getElementById("height") as HTMLInputElement;
  const weightInput = document.getElementById("weight") as HTMLInputElement;
  const calculateBtn = document.getElementById("calculate-btn");
  const resultDiv = document.getElementById("result");
  const bmiValueSpan = document.getElementById("bmi-value");
  const bmiStatusP = document.getElementById("bmi-status");

  // 'calculateBtn'이 실제로 존재하는지 확인한 후 이벤트 리스너를 추가합니다.
  if (calculateBtn) {
    calculateBtn.addEventListener("click", () => {
      // heightInput과 weightInput도 null이 아닐 때만 값을 사용합니다.
      if (!heightInput || !weightInput) return;

      const height = parseFloat(heightInput.value);
      const weight = parseFloat(weightInput.value);

      // 입력값 유효성 검사
      if (isNaN(height) || isNaN(weight) || height <= 0 || weight <= 0) {
        alert("유효한 키와 몸무게를 입력해주세요.");
        return;
      }

      // BMI 계산 (키를 cm에서 m로 변환)
      const heightInMeters = height / 100;
      const bmi = weight / (heightInMeters * heightInMeters);
      const bmiFixed = bmi.toFixed(2); // 소수점 둘째 자리까지 표시

      // BMI 상태 결정
      let status = "";
      let statusClass = "";
      if (bmi < 18.5) {
        status = "저체중";
        statusClass = "text-blue-600";
      } else if (bmi < 23) {
        status = "정상";
        statusClass = "text-green-600";
      } else if (bmi < 25) {
        status = "과체중";
        statusClass = "text-yellow-600";
      } else {
        status = "비만";
        statusClass = "text-red-600";
      }

      // 결과 표시 (각 요소가 존재하는지 확인)
      if (bmiValueSpan) bmiValueSpan.textContent = bmiFixed;
      if (bmiStatusP) {
        bmiStatusP.textContent = status;
        bmiStatusP.className = `mt-2 text-lg font-bold ${statusClass}`;
      }
      if (resultDiv) resultDiv.classList.remove("hidden");
    });
  }
</script>
