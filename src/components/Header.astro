---
// src/pages/d-day.astro
import Layout from "../layouts/Layout.astro";
---

<Layout title="D-Day 계산기 - Numerify">
  <div class="mx-auto max-w-lg rounded-xl bg-white p-8 shadow-lg">
    <h1 class="mb-6 text-center text-3xl font-bold">D-Day 계산기</h1>

    <div class="mb-4">
      <label
        for="dday-date"
        class="mb-2 block text-lg font-medium text-gray-700"
        >목표 날짜를 선택하세요</label
      >
      <input
        type="date"
        id="dday-date"
        class="w-full rounded-md border border-gray-300 p-3 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
      />
    </div>

    <button
      id="calculate-dday-btn"
      class="w-full rounded-lg bg-indigo-600 py-3 text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
    >
      계산하기
    </button>

    <div
      id="dday-result"
      class="mt-8 hidden rounded-lg bg-gray-100 p-6 text-center"
    >
      <p class="text-2xl font-semibold">
        선택한 날짜까지 <span
          id="dday-value"
          class="text-4xl font-bold text-indigo-600"></span>
      </p>
    </div>
  </div>
</Layout>

<script>
  const ddayInput = document.getElementById("dday-date") as HTMLInputElement;
  const calculateBtn = document.getElementById("calculate-dday-btn");
  const resultDiv = document.getElementById("dday-result");
  const ddayValueSpan = document.getElementById("dday-value");

  if (calculateBtn) {
    calculateBtn.addEventListener("click", () => {
      if (!ddayInput || !ddayInput.value) {
        alert("날짜를 선택해주세요.");
        return;
      }

      // 사용자가 선택한 날짜 (현지 시간 기준 자정)
      const targetDate = new Date(ddayInput.value);
      targetDate.setHours(0, 0, 0, 0);

      // 오늘 날짜 (현지 시간 기준 자정)
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      // 밀리초(ms) 단위의 시간 차이를 일(day) 단위로 변환
      const diffTime = targetDate.getTime() - today.getTime();
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

      let resultText = "";
      if (diffDays === 0) {
        resultText = "D-Day!";
      } else if (diffDays > 0) {
        resultText = `D-${diffDays}`;
      } else {
        resultText = `D+${Math.abs(diffDays)}`;
      }

      if (ddayValueSpan) {
        ddayValueSpan.textContent = resultText;
      }
      if (resultDiv) {
        resultDiv.classList.remove("hidden");
      }
    });
  }
</script>
